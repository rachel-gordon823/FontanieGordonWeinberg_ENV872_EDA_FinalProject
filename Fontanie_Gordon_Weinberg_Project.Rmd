---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Air Quality in Ukraine post Ukraine-Russia Dispute"
subtitle: "Web address for GitHub repository"
author: "Shirley Fontanié, Rachel Gordon, and Julia Weinberg"
fontsize: 12pt
mainfont: Times New Roman
editor_options: 
  chunk_output_type: console
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory 

getwd() 

# Load your packages  

library(tidyverse)
library(lubridate)
library(ggplot2)
library(zoo)
library(sf)
library(mapview)
library(leaflet)

mapviewOptions(fgb = FALSE)

# Set your ggplot theme

ourtheme <- theme_classic(base_size = 14)+ 
  theme(axis.text = element_text(color="black"), 
        legend.position = "bottom")
theme_set(ourtheme)
  
# Load your datasets

UkraineData <- read.csv("./Data/RawData/Ukraine_AQIData.csv", stringsAsFactors = TRUE)

#UkraineMap <- read.csv("./Data/RawData/ukrainelatandlong.csv", stringsAsFactors = TRUE)


```

# Rationale and Research Questions

> During periods of war and geopolitical conflicts, environmental pollution and degraded air quality is a common effect experienced by nations subject to violent attacks. Specifically, the use of explosive weapons can cause extensive damage to urban buildings and infrastructure, resulting in hazardous dust, debris, and other air particles that can have lasting health impacts on affected populations.

>On February 24, 2022 Russia invaded Ukraine due to geopolitical conflicts between the two nations. Russia’s invasion has consisted of multiple missile attacks throughout Ukraine, causing extensive damage to urban infrastructure, reducing buildings to rubble and creating dangerous explosions that have enormous potential to raise air pollution levels. Therefore, in this project, we examine two different Ukrainian cities that have experienced attacks since Russia’s invasion and explore air quality levels of these cities both before and during the war.

>As the conflict has been ongoing throughout all of March 2022, we chose to analyze air quality data from March 2022 as well as March 2021. We chose to include data from the same month in 2021 to be able to compare air quality levels during the war to the levels before to control for weather and temperature variations that typically occur throughout different months and seasons. Additionally, we were interested in exploring air quality levels of two cities that are in different geographic locations and have experienced at least one missile attack by Russia during March 2022. For air quality indicators, we wanted to look at both PM 2.5 and PM 10, as the levels of these particulate matters increase from sources such as construction sites and fires and can have lasting effects on human health. PM2.5 are very fine inhalable particles that are 2.5 micrometers or smaller, whereas PM10 are less than 10.5 micrometers. Lastly, we wanted to look at two cities that differed in economic activity and levels of industrial manufacturing, as industrial manufacturing activities can have an effect on air quality levels.

\newpage

# Dataset Information 

> Data for this project was retrieved from the World Air Quality Indices’ Air Quality Historical Data Platform. The World Air Quality Index is a non-profit started in 2007 that is working to increase transparency for air quality data in order to improve pollution awareness. The World Air Quality Index created the Air Quality Historical Data Platform in 2014 in order to provide information on how location-based air quality is changing over time. Data in this report looks at PM10 and PM2.5 air pollution. The World Air Quality Index provides ranges for air quality health and the numbers are differentiated for PM2.5 and PM10. Table 1 provides the ranges for good, moderate, poor, and unhealthy air quality levels. Historical data sets available through the World Air Quality Index span a 36-month time frame, and data used in this report is from 2019-2022. The data was collected for two cities Dnipro and Lviv, located in Eastern and Western Ukraine respectively. The air-quality monitoring station in Lviv is called Steeldrum and the air-quality monitoring station in Dnipro is called Vulytsya-Pavla Nirinberha, 4-6.

```{r Data wrangling, echo = FALSE}  
# Initial wrangling 

Ukraine_Processed <- UkraineData %>% 
  drop_na(pm10) %>% 
  drop_na(pm25) 

# Setting Date 
Ukraine_Processed$date <- as.Date(Ukraine_Processed$date, "%m/%d/%y")
write.csv(Ukraine_Processed, row.names = FALSE, file = "./Data/Processed/Ukraine_Processed.csv")

# Creating subsets by city, month, and year
Dnipro_2021 <- Ukraine_Processed %>% 
  filter(City %in% "Dnipro")%>%
  subset(date > "2021-2-28" & date < "2021-04-01") %>%
  mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))
write.csv(Dnipro_2021, row.names = FALSE, file = "./Data/Processed/Dnipro_2021.csv")

                
Dnipro_2022 <- Ukraine_Processed %>%
  filter(City %in% "Dnipro")%>%
  subset(date > "2022-2-28" & date < "2022-04-01") %>%
   mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))

write.csv(Dnipro_2022, row.names = FALSE, file = "./Data/Processed/Dnipro_2022.csv")

Lviv_2021 <- Ukraine_Processed %>% 
  filter(City %in% "Lviv") %>%
  subset(date > "2021-2-28" & date < "2021-04-01") %>%
  mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))
write.csv(Lviv_2021, row.names = FALSE, file = "./Data/Processed/Lviv_2021.csv")

Lviv_2022 <- Ukraine_Processed %>% 
  filter(City %in% "Lviv") %>%
  subset(date > "2022-2-28" & date < "2022-04-01") %>%
  mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))
write.csv(Lviv_2022, row.names = FALSE, file = "./Data/Processed/Lviv_2022.csv")

#creating subsets by city
FULL_DNIPRO <- bind_rows(Dnipro_2021,Dnipro_2022)
write.csv(FULL_DNIPRO, row.names = FALSE, file = "./Data/Processed/FULL_DNIPRO.csv")

FULL_LVIV <- bind_rows(Lviv_2021,Lviv_2022)
write.csv(FULL_LVIV, row.names = FALSE, file = "./Data/Processed/FULL_LVIV.csv")

```

> Initially once accessing our first csv dataset (outlined in Table 1), we processed the UkraineData by omitting missing values (the NA’s) from the PM2.5 and PM 10 values.  
Then, we set the “numeric” class of the date column to a “date” class. 
Then, we wrangled the processed version of the Ukraine data and created four subsets by city, month, and year. Each city, Dnipro and Lviv, is being evaluated for air quality during the month of March and in years 2021 and 2022. 
Now we have four new data sets; Dnipro 2021, Dnipro 2022, Lviv 2021, and Lviv 2022, all showing PM2.5 and PM10 values for days in March. 
We then binded the rows for both Dnipro 2021 and Dnipro 2022, called FULL_DNIPRO. We also binded rows for Lviv 2021 and Lviv 2022, called FULL_LVIV.   
In our exploratory analysis, we wanted to look at mean, maximum, minimum, and the standard deviation for PM2.5 and PM10 values in Dnipro and Ukraine. We used the group_by function to group by City, and the summarize function to include mean, maximum, minimum, and standard deviation of the PM values. 
Additionally, within the exploratory analysis we binded FULL_Dnipro and FULL_LVIV in order to create a dot plot showing the air quality ranges our data demonstrated. We then plotted this data with ggplot using scale_fill_gradient2 to color-code data by health-hazard level.
Furthermore, we wanted to look at PM2.5 and PM10 values comparing Dnipro and Lviv in solely March 2022 – during the time of the missile attacks. 
To do this analysis, we wrangled the Dnipro 2022 and Lviv 2022 to create a dataset with both cities, that includes both PM values, for solely March 2022. The important difference is that we are not looking at 2021 values in this dataset. Table 2 outlines all of our working data sets and what they each contain.

\newpage
**Table 1**

Data File Name | Column Name | Data Type
---------------| ------------|---------------
UkraineData | City | Factor (Dnipro and Lviv)
UkraineData | Date | Factor (later converted to date object)
UkraineData | pm25 | Integer (PM2.5 values)
UkraineData | pm10 | Integer (PM10 values)

**Table 2**

Data File Name | Description
----------    |------------------
UkraineData | (Raw) Ukraine air quality data 
Ukraine_Processed | (Processed) Ukraine air quality data, w/o na's
Dnipro_2021 | Dnipro PM2.5 + PM10, Mar 2021
Dnipro_2022 | Dnipro PM2.5+ PM10, Mar 2022
Lviv_2021 | Lviv PM 2.5 + PM10, Mar 2021
Lviv_2022 | Lviv PM 2.5 + PM10, Mar 2022
FULL_LVIV | Lviv_2021 + Lviv_2022 combined
FULL_Dnipro | Dnipro_2021 + Dnipro_2022 combined
FULL_Air_quality| Dnipro_2022 + Lviv_2022 combined
Full-air_quality_21_22| FULL_LVIV + FULL_Dnipro combined


\newpage

# Exploratory Analysis 

>To begin our exploratory analysis of the air quality data, we created dot plots to map out what range of our quality our data fell into (Figures 1 & 2). The data is color coded with green denoting good air quality conditions, yellow is moderate conditions, and red is showing air quality that is poor and likely hazardous to health. Attached is a table showing a breakdown for air quality metrics (Table 3). This dot plot was created to show the range in which our data falls in terms of air quality health. Additionally, we determined the summary statistics of the PM10 and PM2.5 (Table 4)

**Table 3**

AQI Category | PM2.5 | PM10
---------------| ------------|---------------
Good | 0 to 15.5 | 0 to 54
Moderate | 15.5 to 35.5 | 54 to 150
Poor | 35.5 to 150 | 150 to 250
Unhealthy | 150+ | 250+

```{r plot of pm2.5 air pollution by levels, echo=FALSE, fig.cap="Figure 1 PM2.5 Air Pollution Dot Plot"}

Full_air_quality_21_22 <- bind_rows(FULL_LVIV, FULL_DNIPRO)%>%
  mutate(Year = as.factor(Year))%>%
  mutate(City_Year=(paste(City,"-",Year)))


PM25_plot <- ggplot(Full_air_quality_21_22, x = City_Year, y = pm25)+
  geom_point(aes(x=City_Year, y = pm25, color = pm25),
            size=5)+
  labs(x = "City Year", y = "PM2.5", legend = "color")+
  theme(legend.position = "right")+
 scale_fill_gradient2(
  low = "#66FF00",
  mid = "#FFFF33",
  high = "#CC0033",
  midpoint = 35.5,
  space = "Lab",
  guide = "colourbar",
  aesthetics = "color"
)

print(PM25_plot)
#PM25_dotplot <- ggplot(Full_air_quality_21_22, 
  #aes(x= City_Year, y = pm25, fill = City))+
  #geom_boxplot()+
  #geom_dotplot(binaxis = 'y', stackdir = 'center')+
  #labs(x = "City Year", y = "PM2.5")+
  #theme(legend.position = "none")
    
#print(PM25_dotplot)

#PM10_dotplot <- ggplot(Full_air_quality_21_22, 
  #aes(x= City_Year, y = pm10, fill = City))+
  #geom_boxplot()+
  #geom_dotplot(binaxis = 'y', stackdir = 'center')+
  #labs(x = "City Year", y = "PM10", color = "City Year")+
  #theme(legend.position = "none")

    

```




```{r plot of pm10 air pollution by levels, echo=FALSE, fig.cap="Figure 1 PM10 Air Pollution Dot Plot"}
PM10_plot <- ggplot(Full_air_quality_21_22, x = City_Year, y = pm10)+
  geom_point(aes(x=City_Year, y = pm10, color = pm10),
             size = 5)+
  labs(x = "City Year", y = "PM10", legend = "color")+
  theme(legend.position = "right")+
 scale_fill_gradient2(
  low = "#66FF00",
  mid = "#FFFF33",
  high = "#CC0033",
  midpoint = 55,
  space = "Lab",
  guide = "colourbar",
  aesthetics = "color"
)
print(PM10_plot)


```
\newpage
```{r summary statistics, echo = FALSE, fig.cap = "Table 4 Summary Statistics"}

#summary statistics PM2.5
air.quality.summary.PM25 <- Ukraine_Processed %>%
  group_by(City) %>%
  summarize(
    mean_PM2.5 = mean(pm25),
    min_PM2.5 = min(pm25),
    max_PM2.5 = max(pm25),
    sd_PM2.5 = sd(pm25)
)

#summary statistics PM10
air.quality.summary.PM10 <- Ukraine_Processed %>%
  group_by(City) %>%
  summarize(
    mean_PM10 = mean(pm10),
    min_PM10 = min(pm10),
    max_PM10 = max(pm10),
    sd_PM10 = sd(pm10)
)

```

 



```{r PM2.5 + PM10, echo = FALSE}


#PM2.5
knitr::kable(air.quality.summary.PM25, caption = "PM2.5 Levels by City", 
             col.names = c("City", "Mean", "Min", "Max", "Std Dev"))

#PM10
knitr::kable(air.quality.summary.PM10, caption = "PM10 Levels by City", 
             col.names = c("City", "Mean", "Min", "Max", "Std Dev"))
```
\newpage

# Analysis

## Question 1: Are there significant differences in air quality levels between affected Ukrainian cities during the Russian invasion?

>[Shirley insert text about how we analyzed - visualizations and statistical tests]

```{r Plotting Lviv vs Dnipro, fig.cap= "Comparing Air Pollution in Lviv vs Dnipro 2022", echo = FALSE}

FULL_Air_quality <- bind_rows(Dnipro_2022,Lviv_2022)

PM25_Lviv_and_Dnipro_PLOT <-
  ggplot(FULL_Air_quality) + 
(aes(x = Day, y = pm25, color = City)) + 
  geom_line()+  
  geom_point()+
  labs(x = "Days in March, 2022", y= "PM2.5",
  title = "        Observing PM2.5 Values in Dnipro and Lviv, Ukraine")  
print(PM25_Lviv_and_Dnipro_PLOT)


PM10_Lviv_and_Dnipro_PLOT <-
  ggplot(FULL_Air_quality) + 
(aes(x = Day, y = pm10, color = City)) + 
  geom_line()+  
  geom_point()+
  labs(x = "Days in March, 2022", y= "PM10",
  title = "         Observing PM10 Values in Dnipro and Lviv, Ukraine")  
print(PM10_Lviv_and_Dnipro_PLOT)





```
```{r lm of air quality by city, echo = FALSE}
dnipro.lviv.pm25.lm <- lm(data = FULL_Air_quality, pm25 ~ City) 
summary(dnipro.lviv.pm25.lm)

dnipro.lviv.pm10.lm <- lm(data = FULL_Air_quality, pm10 ~ City) 
summary(dnipro.lviv.pm10.lm)
```



## Question 2: Are there significant differences in air quality levels in affected Ukrainian cities before and during the Russian attacks? 

>Similiar to our first research question, we conducted a visual analysis of PM2.5 and PM10 levels within Dnipro and Lviv for years 2021 and 2022. For each of our visualizations, we created line plots that showed the air pollution levels within the city, comparing 2021 to 2022. As we needed to visualize the levels of both PM2.5 and PM10, we created four different plots - "PM2.5 Levels in Dnipro", "PM2.5 Levels in Lviv", "PM10 Levels in Dnipro", and "PM10 Levels in Lviv". Within each of these plots, we also created annotations to indicate the specific dates of the missile attacks within the cities to see if there were any PM2.5 or PM10 increases or decreases around those dates. Additionally, we conducted a linear regression analysis for each of these charts to understand if there is a significant difference in PM2.5 levels and PM10 levels within Dnipro and Lviv in March of 2021 compared to March of 2022.\

\newpage

>**PM2.5 in Dnipro**\
>When plotting PM2.5 levels in Dnipro in 2021 compared to 2022, it is evident that overall, PM2.5 levels were higher in 2021 than 2022. It is also interesting to note that around March 11 in 2022, when the missile attack occured, there appears to be an uptick in PM2.5 levels and then sharply decreases shortly after. Overall in both years, there seems to be a variety of fluctuation in PM2.5 levels and they are not consistent within each year. Additionally, within most of 2022, PM2.5 levels stayed within "good" to "moderate" levels, with an exception of reaching a level of "unhealthy for sensitive groups" at the end of March 2022. In March 2021, however, the PM2.5 levels were mainly in the "unhealthy for sensitive groups" or "unhealthy" category, with only a few days throughout that month in "moderate" levels.

>For the statistical analysis, we ran a linear regression model of pm2.5 levels by year within Dnipro, to understand if there are significant differences in PM2.5 levels within the city in March 2021 compared to March 2022. The linear regression showed the slope was negative (-32.253), meaning that PM2.5 levels decreased in 2022 compared to 2021. Additionally, the linear regression showed that the relationship between PM2.5 levels and year in Dnipro is significant (p = 5.074e-10), meaning that there is a significant difference in PM2.5 levels in Dnipro in 2022 compared to 2021.



```{r Visualizing PM25 in Dnipro, fig.cap = "PM2.5 Levels in Dnipro", echo = FALSE} 
# DNIPRO PM2.5

PM25_Dnipro_PLOT <- 
  ggplot(FULL_DNIPRO) + 
  (aes(x = Day, y = pm25, color = Year))+ 
  geom_line()+  
  geom_point()+
  labs(x= "Days in March", y = "PM2.5")+ 
  annotate(geom = "text", x = 11, y = 68, label ="March 11, 2022:")+ 
  annotate(geom = "text", x = 11, y = 59, label ="Missile Attack")
print(PM25_Dnipro_PLOT)


```

```{r lm analysis of PM25 in Dnipro, include = FALSE}
dnipro.25.lm <- lm(data = FULL_DNIPRO, pm25 ~ Year)
summary(dnipro.25.lm) 
```
\newpage
>**PM2.5 in Lviv**\
>When plotting PM2.5 levels in Lviv in 2021 compared to 2022, there is no clear difference in levels between years. It is interesting to note that before the March 18 attack, PM2.5 levels were increasing, and after the March 18, 2022 missile attack, it appears levels sharply decreased. Overall in both years, it appears that there seems to be a variety of fluctuation in PM2.5 in Lviv. Additionally, within both 2021 and 2022, it is very rare that levels are within the "good" range of PM2.5 (<15.4) and are typically within "moderate" to "unhealthy" levels.

>For the statistical analysis, we ran a linear regression model of PM2.5 levels by year within Lviv, to understand if there are significant differences in levels within the city in March 2021 compared to March 2022. Through the analysis, we found that the slope was negative (-10.284), meaning that PM2.5 levels decreased in 2022 compared to 2021. However, the linear regression showed that the negative relationship between PM2.5 levels and year in Lviv is not significant (p=0.1639).


```{r visualizing PM25 in Lviv, fig.cap = "PM2.5 Levels in Lviv", echo = FALSE}
#LVIV PM2.5
PM25_Lviv_PLOT <- 
  ggplot(FULL_LVIV) + 
(aes(x = Day, y = pm25, color = Year)) + 
  geom_line()+  
  geom_point()+
  labs(x = "Days in March", y= "PM2.5")+ 
  annotate(geom = "text", x = 18, y = 150, label ="March 18, 2022:")+ 
  annotate(geom = "text", x = 18, y = 142, label ="1st Missile Attack")+ 
  annotate(geom = "text", x = 26, y = 106, label ="March 26, 2022:")+ 
  annotate(geom = "text", x = 26, y = 98, label ="2nd Missile Attack")
print(PM25_Lviv_PLOT)

```
```{r lm analysis of LVIVPM25, include=FALSE}
lviv.25.lm <- lm(data = FULL_LVIV, pm25 ~ Year)
summary(lviv.25.lm)
```
\newpage
>**PM10 in Dnipro**\
>When plotting PM10 levels in Dnipro in 2021 compared to 2022, it is evident that overall, PM10 levels were higher in 2021 compared to 2022. When looking at the PM10 levels around the March 11 attack in 2022, there does not appear to be a significant increase. Additionally, in March 2022, PM10 levels seemed to stay within or below "moderate" levels, whereas 2021 levels ranged from "moderate" to "unhealthy for sensitive groups".

>For the statistical analysis, we ran a linear regression of PM10 levels by year within Dnipro, to understand if there are significant differences in levels within the city in March 2021 compared to March 2022. Through the analysis, we found that the slope was negative (-15.677), meaning that PM10 levels decreased in 2022 compared to 2021. Additionally, the linear regression showed that these results are statistically significant (p=4.325e-07), meaning there is a significant difference in PM10 levels in Dnipro in 2022 compared to 2021.

```{r visualizing PM10 in Dnipro, fig.cap="PM10 Levels in Dnipro", echo=FALSE}
 

#DNIPRO PM10
PM10_Dnipro_PLOT <-ggplot(FULL_DNIPRO) + 
  (aes(x = Day, y = pm10, color = Year))+ 
  geom_line()+  
  geom_point()+
  labs(x= "Days in March", y = "PM10")+  
  annotate(geom = "text", x = 11, y = 39, label ="March 11, 2022:")+ 
  annotate(geom = "text", x = 11, y = 35, label ="Missile Attack")
print(PM10_Dnipro_PLOT) 
  

```

```{r lm analysis of PM10 in Dnipro, include=FALSE}
#Linear regression
dnipro.10.lm <- lm(data = FULL_DNIPRO, pm10 ~ Year) 
summary(dnipro.10.lm) 
```
\newpage
>**PM10 in Lviv**\
>When plotting PM10 levels in Lviv in 2021 compared to 2022, there is no clear difference observed in PM10 levels between the years. It is also interesting to note that there does not seem to a significant change in PM10 levels after the March 18 attack, and PM10 levels appear to sharply drop after the March 26 attack. Additionally, PM10 levels in both years stay mainly within "unhealthy for sensitive groups" to "good" levels, but at some points in 2021, levels reach into the "unhealthy" level.

>For the statistical analysis, we ran a linear regression of PM10 levels by year within Lviv, to understand if there are significant differences in levels within the city in March 2021 compared to March 2022. Through the analysis, we found that the slope was negative (-5.673), meaning that PM10 levels decreased in 2022 compared to 2021 in Lviv. However, the linear regression showed that these results are not statistically significant (p=0.1364), meaning that there is not a significant difference in PM10 levels in Lviv in 2022 compared to 2021.

```{r visualizing PM10 in Lviv, fig.cap="PM10 Levels in Lviv", echo = FALSE}
#LVIV PM10
PM10_Lviv_PLOT <- ggplot(FULL_LVIV) + 
  (aes(x = Day, y = pm10, color = Year)) + 
  geom_line()+  
  geom_point()+
  labs(x = "Days in March", y= "PM10")+    
  annotate(geom = "text", x = 18, y = 70, label ="March 18, 2022:")+ 
  annotate(geom = "text", x = 18, y = 66, label ="1st Missile Attack")+ 
  annotate(geom = "text", x = 26, y = 55, label ="March 26, 2022:")+ 
  annotate(geom = "text", x = 26, y = 51, label ="2nd Missile Attack")
print(PM10_Lviv_PLOT)

```

```{r lm analysis of Lviv PM10, include = FALSE}

lviv.10.lm <- lm(data = FULL_LVIV, pm10 ~ Year) 
summary(lviv.10.lm) 
```




\newpage

# Summary and Conclusions
## Question 1: Are there significant differences in air quality levels between affected Ukrainian cities during the Russian invasion?

>[insert results from our analysis]

## Question 2: Are there significant differences in air quality levels in affected Ukrainian cities before and during the Russian attacks? 
>[insert text about summary]


>insert text about what may have affected our results, limitations of our data, and what we would do next if we could

\newpage

# References
<add references here if relevant, otherwise delete this section> 
