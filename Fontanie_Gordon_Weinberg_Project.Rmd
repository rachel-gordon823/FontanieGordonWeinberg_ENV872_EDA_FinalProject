---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Air Quality in Ukraine post Ukraine-Russia Dispute"
subtitle: "Web address for GitHub repository"
author: "Curly Girlies: Shirley Fontani√©, Rachel Gordon, and Julia Weinberg"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory 

getwd() 

# Load your packages  

library(tidyverse)
library(lubridate)
library(ggplot2)
library(zoo)
library(sf)
library(mapview)
library(leaflet)

mapviewOptions(fgb = FALSE)

# Set your ggplot theme

ourtheme <- theme_classic(base_size = 14)+ 
  theme(axis.text = element_text(color="black"), 
        legend.position = "top")
theme_set(ourtheme)
  
# Load your datasets

UkraineData <- read.csv("./Data/RawData/Ukraine_AQIData.csv", stringsAsFactors = TRUE)

```

# Rationale and Research Questions

> Research question: How does air quality in various Ukrainian cities differ before and after the Ukraine-Russia dispute?  
*******
> Rationale: On February 24, 2022, Russia attacked Ukraine. The first city attacked was
Lviv and Dnipro. 
> Kyiv was hit February 24th.  

\newpage

# Dataset Information 

> Describe sources of data here (input Julia paragraph)

```{r Data wrangling, echo = FALSE}  
# Initial wrangling 

Ukraine_Processed <- UkraineData %>% 
  drop_na(pm10) %>% 
  drop_na(pm25) 

# Setting Date 
Ukraine_Processed$date <- as.Date(Ukraine_Processed$date, "%m/%d/%y")
write.csv(Ukraine_Processed, row.names = FALSE, file = "./Data/Processed/Ukraine_Processed.csv")

# Creating subsets by city, month, and year
Dnipro_2021 <- Ukraine_Processed %>% 
  filter(City %in% "Dnipro")%>%
  subset(date > "2021-2-28" & date < "2021-04-01") %>%
  mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))
write.csv(Dnipro_2021, row.names = FALSE, file = "./Data/Processed/Dnipro_2021.csv")

                
Dnipro_2022 <- Ukraine_Processed %>%
  filter(City %in% "Dnipro")%>%
  subset(date > "2022-2-28" & date < "2022-04-01") %>%
   mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))

write.csv(Dnipro_2022, row.names = FALSE, file = "./Data/Processed/Dnipro_2022.csv")

Lviv_2021 <- Ukraine_Processed %>% 
  filter(City %in% "Lviv") %>%
  subset(date > "2021-2-28" & date < "2021-04-01") %>%
  mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))
write.csv(Lviv_2021, row.names = FALSE, file = "./Data/Processed/Lviv_2021.csv")

Lviv_2022 <- Ukraine_Processed %>% 
  filter(City %in% "Lviv") %>%
  subset(date > "2022-2-28" & date < "2022-04-01") %>%
  mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))
write.csv(Lviv_2022, row.names = FALSE, file = "./Data/Processed/Lviv_2022.csv")

#creating subsets by city
FULL_DNIPRO <- bind_rows(Dnipro_2021,Dnipro_2022)
write.csv(FULL_DNIPRO, row.names = FALSE, file = "./Data/Processed/FULL_DNIPRO.csv")

FULL_LVIV <- bind_rows(Lviv_2021,Lviv_2022)
write.csv(FULL_LVIV, row.names = FALSE, file = "./Data/Processed/FULL_LVIV.csv")

```

> Explain data wrangling process here (shirley do this) 

Data File Name | Description
----------    |------------------
UkraineData | (Raw) Ukraine air quality data 
Ukraine_Processed | (Processed) Ukraine air quality data, w/o na's
Dnipro_2021 | Dnipro PM2.5 + PM10, Mar 2021
Dnipro_2022 | Dnipro PM2.5+ PM10, Mar 2022
Lviv_2021 | Lviv PM 2.5 + PM10, Mar 2021
Lviv_2022 | Lviv PM 2.5 + PM10, Mar 2022
FULL_DNIPRO | Lviv_2021 + Lviv_2022 combined
FULL_LVIV | Dnipro_2021 + Dnipro_2022 combined
\newpage

# Exploratory Analysis 


```{r mapping lviv and dnipro}
#I'm confused if we need to upload a shapefile of ukraine so that we can make a map but maybe im really overthinking this - just wanted to put it as a comment here so i dont forget 

#https://simplemaps.com/data/ua-cities
#we can download a csv of all the cities with lat and long from this link and we could make a map but idk if thats what you guys were thinking
```

```{r summary statistics, echo = FALSE}

#summary statistics PM2.5
air.quality.summary.PM25 <- Ukraine_Processed %>%
  group_by(City) %>%
  summarize(
    mean_PM2.5 = mean(pm25),
    min_PM2.5 = min(pm25),
    max_PM2.5 = max(pm25),
    sd_PM2.5 = sd(pm25)
)

#summary statistics PM10
air.quality.summary.PM10 <- Ukraine_Processed %>%
  group_by(City) %>%
  summarize(
    mean_PM10 = mean(pm10),
    min_PM10 = min(pm10),
    max_PM10 = max(pm10),
    sd_PM10 = sd(pm10)
)

```

```{r heat map of air pollution, echo=FALSE, fig.cap="Air Pollution Heat Map"}

Full_air_quality_21_22 <- bind_rows(FULL_LVIV, FULL_DNIPRO)

Full_air_quality_21_22 <- Full_air_quality_21_22 %>%
  mutate(Year = as.factor(Year))

Full_air_quality_21_22 <-Full_air_quality_21_22 %>%
  mutate(City_Year=(paste(City,"-",Year)))

PM25_heatmap <- ggplot(Full_air_quality_21_22, aes(x = City_Year, y = pm25, color = pm25))+
geom_tile() + scale_fill_gradient()

print(PM25_heatmap) 

```


```{r PM2.5 + PM10, echo = FALSE}
#PM2.5
knitr::kable(air.quality.summary.PM25, caption = "PM2.5 Levels by City", 
             col.names = c("City", "Mean", "Min", "Max", "Std Dev"))

#PM10
knitr::kable(air.quality.summary.PM10, caption = "PM10 Levels by City", 
             col.names = c("City", "Mean", "Min", "Max", "Std Dev"))
```

```{r Plotting.PM25, fig.cap = "Comparing PM2.5 in Dnipro and Lviv, Ukraine"} 
# DNIPRO PM2.5

#group=as.Date(year(Dnipro_2021$date)), color =as.Date(year(Dnipro_2021$date)))
#aes(month(date, label = TRUE, abbr = TRUE)) 

PM25_Dnipro_PLOT <- 
  ggplot(FULL_DNIPRO) + 
  (aes(x = Day, y = pm25, color = Year))+ 
  geom_line()+  
  geom_point()+
  labs(x= "Days in March", y = "PM2.5",
  title = "          Observing PM2.5 Values in Dnipro, Ukraine")+ 
  annotate(geom = "text", x = 11, y = 68, label ="March 11, 2022:")+ 
  annotate(geom = "text", x = 11, y = 59, label ="Missile Attack")
print(PM25_Dnipro_PLOT)


# LVIV PM2.5
PM25_Lviv_PLOT <- 
  ggplot(FULL_LVIV) + 
(aes(x = Day, y = pm25, color = Year)) + 
              geom_line()+  
  geom_point()+
  labs(x = "Days in March", y= "PM2.5",
  title = "          Observing PM2.5 Values in Lviv, Ukraine")+ 
  annotate(geom = "text", x = 18, y = 150, label ="March 18, 2022:")+ 
  annotate(geom = "text", x = 18, y = 142, label ="1st Missile Attack")+ 
  annotate(geom = "text", x = 26, y = 106, label ="March 26, 2022:")+ 
  annotate(geom = "text", x = 26, y = 98, label ="2nd Missile Attack")
print(PM25_Lviv_PLOT)


```

```{r Plotting PM2.5 & PM10 in Dnipro and Lviv, fig.cap="Compari}

#DNIPRO PM2.5
PM10_Dnipro_PLOT <-ggplot(FULL_DNIPRO) + 
  (aes(x = Day, y = pm10, color = Year))+ 
  geom_line()+  
  geom_point()+
  labs(x= "Days in March", y = "PM10",
  title = "         Observing PM10 Values in Dnipro, Ukraine")+  
  annotate(geom = "text", x = 11, y = 39, label ="March 11, 2022:")+ 
  annotate(geom = "text", x = 11, y = 35, label ="Missile Attack")
print(PM10_Dnipro_PLOT) 
  

#LVIV PM10
PM10_Lviv_PLOT <- ggplot(FULL_LVIV) + 
  (aes(x = Day, y = pm10, color = Year)) + 
  geom_line()+  
  geom_point()+
  labs(x = "Days in March", y= "PM10",
  title = "         Observing PM10 Values in Lviv, Ukraine")+    
  annotate(geom = "text", x = 18, y = 70, label ="March 18, 2022:")+ 
  annotate(geom = "text", x = 18, y = 66, label ="1st Missile Attack")+ 
  annotate(geom = "text", x = 26, y = 55, label ="March 26, 2022:")+ 
  annotate(geom = "text", x = 26, y = 51, label ="2nd Missile Attack")
print(PM10_Lviv_PLOT)


```

```{r Plotting Lviv vs Dnipro, fig.cap= "Comparing Air Pollution in Lviv vs Dnipro"}

FULL_Air_quality <- bind_rows(Dnipro_2022,Lviv_2022)

PM25_Lviv_and_Dnipro_PLOT <-
  ggplot(FULL_Air_quality) + 
(aes(x = Day, y = pm25, color = City)) + 
  geom_line()+  
  geom_point()+
  labs(x = "Days in March, 2022", y= "PM2.5",
  title = "        Observing PM2.5 Values in Dnipro and Lviv, Ukraine")  
print(PM25_Lviv_and_Dnipro_PLOT)

PM10_Lviv_and_Dnipro_PLOT <-
  ggplot(FULL_Air_quality) + 
(aes(x = Day, y = pm10, color = City)) + 
  geom_line()+  
  geom_point()+
  labs(x = "Days in March, 2022", y= "PM10",
  title = "         Observing PM10 Values in Dnipro and Lviv, Ukraine")  
print(PM10_Lviv_and_Dnipro_PLOT)


```


\newpage

# Analysis

## Question 1: Are there significant differences in air quality levels between affected Ukrainian cities during the Russian invasion?

[insert text about how we analyzed]

## Question 2:  Do air quality levels worsen in affected cities around missile attack events?
[insert text about how we analyzed]

## Question 3: Are there significant differences in air quality levels in affected Ukrainian cities before and during the Russian attacks? 
[insert text about how we analyzed]

```{r lm analysis}

lviv.25.lm <- lm(data = FULL_LVIV, pm25 ~ Year) 
summary(lviv.25.lm) 

lviv.10.lm <- lm(data = FULL_LVIV, pm10 ~ Year) 
summary(lviv.10.lm) 

dnipro.25.lm <- lm(data = FULL_DNIPRO, pm25 ~ Year) 
summary(dnipro.25.lm) 

dnipro.10.lm <- lm(data = FULL_DNIPRO, pm10 ~ Year) 
summary(dnipro.10.lm) 

dnipro.lviv.pm25.lm <- lm(data = FULL_Air_quality, pm25 ~ City) 
summary(dnipro.lviv.pm25.lm)

dnipro.lviv.pm10.lm <- lm(data = FULL_Air_quality, pm10 ~ City) 
summary(dnipro.lviv.pm10.lm)
```






\newpage

# Summary and Conclusions
## Question 1: Are there significant differences in air quality levels between affected Ukrainian cities during the Russian invasion?

[insert text about summary]

## Question 2:  Do air quality levels worsen in affected cities around missile attack events?
[insert text about summary]

## Question 3: Are there significant differences in air quality levels in affected Ukrainian cities before and during the Russian attacks? 
[insert text about summary]

\newpage

# References
<add references here if relevant, otherwise delete this section> 
