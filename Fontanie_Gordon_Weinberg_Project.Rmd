---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Air Quality in Ukraine post Ukraine-Russia Dispute"
subtitle: "Web address for GitHub repository"
author: "Shirley Fontani√©, Rachel Gordon, and Julia Weinberg"
fontsize: 12pt
mainfont: Times New Roman
editor_options: 
  chunk_output_type: console
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory 

getwd() 

# Load your packages  

library(tidyverse)
library(lubridate)
library(ggplot2)
library(zoo)
library(sf)
library(mapview)
library(leaflet)

mapviewOptions(fgb = FALSE)

# Set your ggplot theme

ourtheme <- theme_classic(base_size = 14)+ 
  theme(axis.text = element_text(color="black"), 
        legend.position = "bottom")
theme_set(ourtheme)
  
# Load your datasets

UkraineData <- read.csv("./Data/RawData/Ukraine_AQIData.csv", stringsAsFactors = TRUE)

#UkraineMap <- read.csv("./Data/RawData/ukrainelatandlong.csv", stringsAsFactors = TRUE)


```

# Rationale and Research Questions

> Rachel input written section  

\newpage

# Dataset Information 

> Describe sources of data here (input Julia paragraph)

```{r Data wrangling, echo = FALSE}  
# Initial wrangling 

Ukraine_Processed <- UkraineData %>% 
  drop_na(pm10) %>% 
  drop_na(pm25) 

# Setting Date 
Ukraine_Processed$date <- as.Date(Ukraine_Processed$date, "%m/%d/%y")
write.csv(Ukraine_Processed, row.names = FALSE, file = "./Data/Processed/Ukraine_Processed.csv")

# Creating subsets by city, month, and year
Dnipro_2021 <- Ukraine_Processed %>% 
  filter(City %in% "Dnipro")%>%
  subset(date > "2021-2-28" & date < "2021-04-01") %>%
  mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))
write.csv(Dnipro_2021, row.names = FALSE, file = "./Data/Processed/Dnipro_2021.csv")

                
Dnipro_2022 <- Ukraine_Processed %>%
  filter(City %in% "Dnipro")%>%
  subset(date > "2022-2-28" & date < "2022-04-01") %>%
   mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))

write.csv(Dnipro_2022, row.names = FALSE, file = "./Data/Processed/Dnipro_2022.csv")

Lviv_2021 <- Ukraine_Processed %>% 
  filter(City %in% "Lviv") %>%
  subset(date > "2021-2-28" & date < "2021-04-01") %>%
  mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))
write.csv(Lviv_2021, row.names = FALSE, file = "./Data/Processed/Lviv_2021.csv")

Lviv_2022 <- Ukraine_Processed %>% 
  filter(City %in% "Lviv") %>%
  subset(date > "2022-2-28" & date < "2022-04-01") %>%
  mutate(Month = month(date), 
         Day = day(date), 
          Year = as.factor(year(date)))
write.csv(Lviv_2022, row.names = FALSE, file = "./Data/Processed/Lviv_2022.csv")

#creating subsets by city
FULL_DNIPRO <- bind_rows(Dnipro_2021,Dnipro_2022)
write.csv(FULL_DNIPRO, row.names = FALSE, file = "./Data/Processed/FULL_DNIPRO.csv")

FULL_LVIV <- bind_rows(Lviv_2021,Lviv_2022)
write.csv(FULL_LVIV, row.names = FALSE, file = "./Data/Processed/FULL_LVIV.csv")

```

> Explain data wrangling process here (shirley do this) 

Data File Name | Description
----------    |------------------
UkraineData | (Raw) Ukraine air quality data 
Ukraine_Processed | (Processed) Ukraine air quality data, w/o na's
Dnipro_2021 | Dnipro PM2.5 + PM10, Mar 2021
Dnipro_2022 | Dnipro PM2.5+ PM10, Mar 2022
Lviv_2021 | Lviv PM 2.5 + PM10, Mar 2021
Lviv_2022 | Lviv PM 2.5 + PM10, Mar 2022
FULL_DNIPRO | Lviv_2021 + Lviv_2022 combined
FULL_LVIV | Dnipro_2021 + Dnipro_2022 combined
FULL_Air_quality|
Full-air_quality_21_22|


\newpage

# Exploratory Analysis 

>INSERT COMMENTARY ABOUT EXPLORATORY ANALYSIS COMPONENTS

```{r mapping lviv and dnipro}
#I'm confused if we need to upload a shapefile of ukraine so that we can make a map but maybe im really overthinking this - just wanted to put it as a comment here so i dont forget 

#https://simplemaps.com/data/ua-cities
#we can download a csv of all the cities with lat and long from this link and we could make a map but idk if thats what you guys were thinking

```

```{r summary statistics, echo = FALSE}

#summary statistics PM2.5
air.quality.summary.PM25 <- Ukraine_Processed %>%
  group_by(City) %>%
  summarize(
    mean_PM2.5 = mean(pm25),
    min_PM2.5 = min(pm25),
    max_PM2.5 = max(pm25),
    sd_PM2.5 = sd(pm25)
)

#summary statistics PM10
air.quality.summary.PM10 <- Ukraine_Processed %>%
  group_by(City) %>%
  summarize(
    mean_PM10 = mean(pm10),
    min_PM10 = min(pm10),
    max_PM10 = max(pm10),
    sd_PM10 = sd(pm10)
)

```

```{r plot of air pollution by levels, echo=FALSE, fig.cap="Air Pollution Heat Map"}

Full_air_quality_21_22 <- bind_rows(FULL_LVIV, FULL_DNIPRO)%>%
  mutate(Year = as.factor(Year))%>%
  mutate(City_Year=(paste(City,"-",Year)))


PM25_plot <- ggplot(Full_air_quality_21_22, x = City_Year, y = pm25)+
  geom_point(aes(x=City_Year, y = pm25, color = pm25))+
  labs(x = "City Year", y = "PM2.5", legend = "color")+
  theme(legend.position = "right")+
 scale_fill_gradient2(
  low = "#66FF00",
  mid = "#FFFF33",
  high = "#CC0033",
  midpoint = 35.5,
  space = "Lab",
  guide = "colourbar",
  aesthetics = "color"
)


PM25_dotplot <- ggplot(Full_air_quality_21_22, 
  aes(x= City_Year, y = pm25, fill = City))+
  geom_boxplot()+
  geom_dotplot(binaxis = 'y', stackdir = 'center')+
  labs(x = "City Year", y = "PM2.5")+
  theme(legend.position = "none")
    
print(PM25_dotplot)

PM10_dotplot <- ggplot(Full_air_quality_21_22, 
  aes(x= City_Year, y = pm10, fill = City))+
  geom_boxplot()+
  geom_dotplot(binaxis = 'y', stackdir = 'center')+
  labs(x = "City Year", y = "PM10", color = "City Year")+
  theme(legend.position = "none")

    
print(PM25_plot)

PM10_plot <- ggplot(Full_air_quality_21_22, x = City_Year, y = pm10)+
  geom_point(aes(x=City_Year, y = pm10, color = pm10))+
  labs(x = "City Year", y = "PM10", legend = "color")+
  theme(legend.position = "right")+
 scale_fill_gradient2(
  low = "#66FF00",
  mid = "#FFFF33",
  high = "#CC0033",
  midpoint = 35.5,
  space = "Lab",
  guide = "colourbar",
  aesthetics = "color"
)
print(PM10_plot)


```


```{r PM2.5 + PM10, echo = FALSE}


#PM2.5
knitr::kable(air.quality.summary.PM25, caption = "PM2.5 Levels by City", 
             col.names = c("City", "Mean", "Min", "Max", "Std Dev"))

#PM10
knitr::kable(air.quality.summary.PM10, caption = "PM10 Levels by City", 
             col.names = c("City", "Mean", "Min", "Max", "Std Dev"))
```
\newpage

# Analysis

## Question 1: Are there significant differences in air quality levels between affected Ukrainian cities during the Russian invasion?

>[Shirley insert text about how we analyzed - visualizations and statistical tests]

```{r Plotting Lviv vs Dnipro, fig.cap= "Comparing Air Pollution in Lviv vs Dnipro 2022", echo = FALSE}

FULL_Air_quality <- bind_rows(Dnipro_2022,Lviv_2022)

PM25_Lviv_and_Dnipro_PLOT <-
  ggplot(FULL_Air_quality) + 
(aes(x = Day, y = pm25, color = City)) + 
  geom_line()+  
  geom_point()+
  labs(x = "Days in March, 2022", y= "PM2.5",
  title = "        Observing PM2.5 Values in Dnipro and Lviv, Ukraine")  
print(PM25_Lviv_and_Dnipro_PLOT)


PM10_Lviv_and_Dnipro_PLOT <-
  ggplot(FULL_Air_quality) + 
(aes(x = Day, y = pm10, color = City)) + 
  geom_line()+  
  geom_point()+
  labs(x = "Days in March, 2022", y= "PM10",
  title = "         Observing PM10 Values in Dnipro and Lviv, Ukraine")  
print(PM10_Lviv_and_Dnipro_PLOT)





```
```{r lm of air quality by city, echo = FALSE}
dnipro.lviv.pm25.lm <- lm(data = FULL_Air_quality, pm25 ~ City) 
summary(dnipro.lviv.pm25.lm)

dnipro.lviv.pm10.lm <- lm(data = FULL_Air_quality, pm10 ~ City) 
summary(dnipro.lviv.pm10.lm)
```



## Question 2: Are there significant differences in air quality levels in affected Ukrainian cities before and during the Russian attacks? 

>Similiar to our first research question, we conducted a visual analysis of PM2.5 and PM10 levels within Dnipro and Lviv for years 2021 and 2022. For each of our visualizations, we created line plots that showed the air pollution levels within the city, comparing 2021 to 2022. As we needed to visualize the levels of both PM2.5 and PM10, we created four different plots - "PM2.5 Levels in Dnipro", "PM2.5 Levels in Lviv", "PM10 Levels in Dnipro", and "PM10 Levels in Lviv". Within each of these plots, we also created annotations to indicate the specific dates of the missile attacks within the cities to see if there were any PM2.5 or PM10 increases or decreases around those dates. Additionally, we conducted a linear regression analysis for each of these charts to understand if there is a significant difference in PM2.5 levels and PM10 levels within Dnipro and Lviv in March of 2021 compared to March of 2022.\

\newpage

>**PM2.5 in Dnipro**\
>When plotting PM2.5 levels in Dnipro in 2021 compared to 2022, it is evident that overall, PM2.5 levels were higher in 2021 than 2022. It is also interesting to note that around March 11 in 2022, when the missile attack occured, there appears to be an uptick in PM2.5 levels and then sharply decreases shortly after. Overall in both years, there seems to be a variety of fluctuation in PM2.5 levels and they are not consistent within each year. Additionally, within most of 2022, PM2.5 levels stayed within "good" to "moderate" levels, with an exception of reaching a level of "unhealthy for sensitive groups" at the end of March 2022. In March 2021, however, the PM2.5 levels were mainly in the "unhealthy for sensitive groups" or "unhealthy" category, with only a few days throughout that month in "moderate" levels.

>For the statistical analysis, we ran a linear regression model of pm2.5 levels by year within Dnipro, to understand if there are significant differences in PM2.5 levels within the city in March 2021 compared to March 2022. The linear regression showed the slope was negative (-32.253), meaning that PM2.5 levels decreased in 2022 compared to 2021. Additionally, the linear regression showed that the relationship between PM2.5 levels and year in Dnipro is significant (p = 5.074e-10), meaning that there is a significant difference in PM2.5 levels in Dnipro in 2022 compared to 2021.



```{r Visualizing PM25 in Dnipro, fig.cap = "PM2.5 Levels in Dnipro", echo = FALSE} 
# DNIPRO PM2.5

PM25_Dnipro_PLOT <- 
  ggplot(FULL_DNIPRO) + 
  (aes(x = Day, y = pm25, color = Year))+ 
  geom_line()+  
  geom_point()+
  labs(x= "Days in March", y = "PM2.5")+ 
  annotate(geom = "text", x = 11, y = 68, label ="March 11, 2022:")+ 
  annotate(geom = "text", x = 11, y = 59, label ="Missile Attack")
print(PM25_Dnipro_PLOT)


```

```{r lm analysis of PM25 in Dnipro, include = FALSE}
dnipro.25.lm <- lm(data = FULL_DNIPRO, pm25 ~ Year)
summary(dnipro.25.lm) 
```
\newpage
>**PM2.5 in Lviv**\
>When plotting PM2.5 levels in Lviv in 2021 compared to 2022, there is no clear difference in levels between years. It is interesting to note that before the March 18 attack, PM2.5 levels were increasing, and after the March 18, 2022 missile attack, it appears levels sharply decreased. Overall in both years, it appears that there seems to be a variety of fluctuation in PM2.5 in Lviv. Additionally, within both 2021 and 2022, it is very rare that levels are within the "good" range of PM2.5 (<15.4) and are typically within "moderate" to "unhealthy" levels.

>For the statistical analysis, we ran a linear regression model of PM2.5 levels by year within Lviv, to understand if there are significant differences in levels within the city in March 2021 compared to March 2022. Through the analysis, we found that the slope was negative (-10.284), meaning that PM2.5 levels decreased in 2022 compared to 2021. However, the linear regression showed that the negative relationship between PM2.5 levels and year in Lviv is not significant (p=0.1639).


```{r visualizing PM25 in Lviv, fig.cap = "PM2.5 Levels in Lviv", echo = FALSE}
#LVIV PM2.5
PM25_Lviv_PLOT <- 
  ggplot(FULL_LVIV) + 
(aes(x = Day, y = pm25, color = Year)) + 
  geom_line()+  
  geom_point()+
  labs(x = "Days in March", y= "PM2.5")+ 
  annotate(geom = "text", x = 18, y = 150, label ="March 18, 2022:")+ 
  annotate(geom = "text", x = 18, y = 142, label ="1st Missile Attack")+ 
  annotate(geom = "text", x = 26, y = 106, label ="March 26, 2022:")+ 
  annotate(geom = "text", x = 26, y = 98, label ="2nd Missile Attack")
print(PM25_Lviv_PLOT)

```
```{r lm analysis of LVIVPM25, include=FALSE}
lviv.25.lm <- lm(data = FULL_LVIV, pm25 ~ Year)
summary(lviv.25.lm)
```
\newpage
>**PM10 in Dnipro**\
>When plotting PM10 levels in Dnipro in 2021 compared to 2022, it is evident that overall, PM10 levels were higher in 2021 compared to 2022. When looking at the PM10 levels around the March 11 attack in 2022, there does not appear to be a significant increase. Additionally, in March 2022, PM10 levels seemed to stay within or below "moderate" levels, whereas 2021 levels ranged from "moderate" to "unhealthy for sensitive groups".

>For the statistical analysis, we ran a linear regression of PM10 levels by year within Dnipro, to understand if there are significant differences in levels within the city in March 2021 compared to March 2022. Through the analysis, we found that the slope was negative (-15.677), meaning that PM10 levels decreased in 2022 compared to 2021. Additionally, the linear regression showed that these results are statistically significant (p=4.325e-07), meaning there is a significant difference in PM10 levels in Dnipro in 2022 compared to 2021.

```{r visualizing PM10 in Dnipro, fig.cap="PM10 Levels in Dnipro", echo=FALSE}
 

#DNIPRO PM10
PM10_Dnipro_PLOT <-ggplot(FULL_DNIPRO) + 
  (aes(x = Day, y = pm10, color = Year))+ 
  geom_line()+  
  geom_point()+
  labs(x= "Days in March", y = "PM10")+  
  annotate(geom = "text", x = 11, y = 39, label ="March 11, 2022:")+ 
  annotate(geom = "text", x = 11, y = 35, label ="Missile Attack")
print(PM10_Dnipro_PLOT) 
  

```

```{r lm analysis of PM10 in Dnipro, include=FALSE}
#Linear regression
dnipro.10.lm <- lm(data = FULL_DNIPRO, pm10 ~ Year) 
summary(dnipro.10.lm) 
```
\newpage
>**PM10 in Lviv**\
>When plotting PM10 levels in Lviv in 2021 compared to 2022, there is no clear difference observed in PM10 levels between the years. It is also interesting to note that there does not seem to a significant change in PM10 levels after the March 18 attack, and PM10 levels appear to sharply drop after the March 26 attack. Additionally, PM10 levels in both years stay mainly within "unhealthy for sensitive groups" to "good" levels, but at some points in 2021, levels reach into the "unhealthy" level.

>For the statistical analysis, we ran a linear regression of PM10 levels by year within Lviv, to understand if there are significant differences in levels within the city in March 2021 compared to March 2022. Through the analysis, we found that the slope was negative (-5.673), meaning that PM10 levels decreased in 2022 compared to 2021 in Lviv. However, the linear regression showed that these results are not statistically significant (p=0.1364), meaning that there is not a significant difference in PM10 levels in Lviv in 2022 compared to 2021.

```{r visualizing PM10 in Lviv, fig.cap="PM10 Levels in Lviv", echo = FALSE}
#LVIV PM10
PM10_Lviv_PLOT <- ggplot(FULL_LVIV) + 
  (aes(x = Day, y = pm10, color = Year)) + 
  geom_line()+  
  geom_point()+
  labs(x = "Days in March", y= "PM10")+    
  annotate(geom = "text", x = 18, y = 70, label ="March 18, 2022:")+ 
  annotate(geom = "text", x = 18, y = 66, label ="1st Missile Attack")+ 
  annotate(geom = "text", x = 26, y = 55, label ="March 26, 2022:")+ 
  annotate(geom = "text", x = 26, y = 51, label ="2nd Missile Attack")
print(PM10_Lviv_PLOT)

```

```{r lm analysis of Lviv PM10, include = FALSE}

lviv.10.lm <- lm(data = FULL_LVIV, pm10 ~ Year) 
summary(lviv.10.lm) 
```




\newpage

# Summary and Conclusions
## Question 1: Are there significant differences in air quality levels between affected Ukrainian cities during the Russian invasion?

>[insert results from our analysis]

## Question 2: Are there significant differences in air quality levels in affected Ukrainian cities before and during the Russian attacks? 
>[insert text about summary]


>insert text about what may have affected our results, limitations of our data, and what we would do next if we could

\newpage

# References
<add references here if relevant, otherwise delete this section> 
